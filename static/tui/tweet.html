<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../../bower_components/paper-styles/paper-styles.html">

<dom-module id="tui-tweet">

  <link rel="stylesheet" href="../style/notosans.css">

  <!-- TODO: Enable to put fonts in config dir -->

  <style is="custom-style">
    @font-face {
      font-family: "Noto Sans CJK JP";
      src: local('Noto Sans CJK JP'),
           url(../../resources/fonts/NotoSansCJKjp-Light.woff) format('woff2'),
           url(../../resources/fonts/NotoSansCJKjp-Light.otf) format('opentype');
    }

    @font-face {
      font-family: "IPA P Gothic";
      src: local('IPAPGothic');
    }

    .item {
      background-color: white;
      @apply(--shadow-elevation-2dp);
    }
    .avatar {
      display: inline-block;
      width: 40px;
      height: 40px;
      border-radius: 20%;
      overflow: hidden;
    }
    .username {
      float: left;
    }
    .date {
      float: right;
    }
    .tweet_text {
      font-family: "Noto Sans CJK JP", "Noto Sans Japanese", sans-serif;
      white-space: pre-wrap;
    }
  </style>

  <template class="tweet_panel">
    <div class="item">
      <paper-icon-item>
        <img class="avatar" src="{{tweet.user.profile_image_url}}" item-icon></img>
        <paper-item-body two-line>
          <div class="user" secondary layout horizontal flex>
            <a href$="{{user_url(tweet.user.screen_name)}}">
              <span class="username" flex>@<span>{{tweet.user.screen_name}}</span></span>
            </a>
            <span class="date">{{tweet.created_at}}</span>
          </div>
          <div class="tweet_text">{{make_text(tweet)}}</div>
        </paper-item-body>
      </paper-icon-item>
    </div>
  </template>

  <script>
    Polymer({
      is: "tui-tweet",

      properties: {
        tweet: Object
      },

      user_url: function(screen_name) {
        return 'https://twitter.com/' + screen_name;
      },

      make_text: function(tweet) {
        // TODO: Change URLs in the tweet to links
        var text = tweet.text;
        console.log('entities: ' + JSON.stringify(tweet.entities));
        for (var e of tweet.entities.urls) {
          text = text.replace(e.url, e.expanded_url);
        }
        return text;
      }
    });
  </script>
</dom-module>
